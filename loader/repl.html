<!DOCTYPE html>
<html>
<head>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdn.rawgit.com/jcubic/jquery.terminal/master/js/jquery.terminal.min.js"></script>
    <link href="https://cdn.rawgit.com/jcubic/jquery.terminal/master/css/jquery.terminal.min.css" rel="stylesheet"/>
    <script src="https://cdn.rawgit.com/jcubic/jquery.terminal/master/js/unix_formatting.js"></script>
    <style>
        body {
            margin: 0;
            font-family: sans-serif;
            overflow:hidden;
        }
        .tabs {
            display: flex;
            flex-wrap: wrap;
            background: #eee;
            height: 100%;
            min-height: 100%;
            align-items: flex-start;
            align-content: flex-start;
        }
        .tabs label {
            order: 1;
            display: block;
            padding: 6px 25px;
            margin-right: 0.2rem;
            cursor: pointer;
            background: #ccc;
            font-weight: bold;
            transition: background ease 0.2s;
        }
        .tabs .tab {
            order: 99;
            flex-grow: 1;
            width: 100%;
            display: none;
            background: #fff;
            padding-top: 5px;
            height: calc(100% - 30px);
        }
        .tabs input[type="radio"] {
            display: none;
        }
        .tabs input[type="radio"]:checked + label {
            background: #fff;
        }
        .tabs input[type="radio"]:checked + label + .tab {
            display: block;
        }
        .dispbox {
            display: flex;
            justify-content: center;
        }
        .main {
            height: 100vh;
        }
        .box {
            position: relative;
            width: 50vw;
            height: 100vh;
        }
        #plot {
            background-color: #727272;
            align-items: center;
            height: 100%;
            position: relative;
        }
        #plot-canvas {
            background-color: #FFFFFF;
            width: 40vw;
            height: 40vw;
            max-height: 80vh;
            max-width: 80vh;
        }
        #plot-save {
            position: absolute;
            top: 5px;
            right: 5px;
        }
        #files-bar {
            display: flex;
            flex-wrap: wrap;
            flex-direction: row;
            align-items: stretch;
            width: 100%;
        }
        @media (orientation: portrait) {
            .dispbox {
                flex-flow: column;
            }
            .box {
                width: 100vw;
                height: 50vh;
            }
            #plot-canvas {
                width: 40vh;
                height: 40vh;
                max-height: 80vw;
                max-width: 80vw;
            }
        }
    </style>
</head>
<body>
    <div class="main dispbox">
        <div id='term' class="box"></div>
    </div>
</body>
<script>
    var term = $('#term').terminal([], {
        prompt: '',
        greetings: false,
        history: true
    });
    term.echo("R is downloading, please wait...");
</script>
<script>
  var worker = new Worker('worker.js')

  worker.onmessage = function(msg) {
      var event = msg.data.event;
      var data = msg.data.data;

      switch (event) {
      case 'stdout':
          term.echo(data);
          break;
      case 'stderr':
          if (arguments.length > 1) {
              data = Array.prototype.slice.call(arguments).join(' ');
          }
          term.error(data);
          break;
      case 'read':
          term.read(
              data.text,
              function(text) {
                  var resp = { text: text, data: data };
                  worker.postMessage({ event: 'input', data: resp });
              }
          );
          term.history().enable();
          break;
      default:
          console.log('Undefined event in main thread');
          break;
      }
  }

  var options = {
      Rargs: [],
      ENV: {
          R_NSIZE: '1000000',
          R_VSIZE: '64M',
          R_HOME: '/usr/lib/R',
          R_ENABLE_JIT: '0',
          R_DEFAULT_DEVICE: 'canvas',
          COLORTERM: 'truecolor',
      }
  }
  worker.postMessage({ event: 'init', data: options })
</script>
</html>
